---
const { pathname } = Astro.url;
const isNo = pathname.startsWith("/no");
const currentLang = isNo ? "no" : "en";

const navLinks = [
    { name: isNo ? "Hjem" : "Home", href: `/${currentLang}/` },
    {
        name: isNo ? "Om oss" : "About us",
        href: `/${currentLang}/about/`,
        dropdown: [
            {
                name: isNo ? "Historie" : "History",
                href: `/${currentLang}/about/history`,
            },
            {
                name: isNo ? "Offentlige dokumenter" : "Public records",
                href: "https://drive.google.com/drive/folders/1r7ZnV6gpdHxkjha2z8BG5Nvs3qWahIPz",
                external: true,
            },
            {
                name: isNo ? "Roller" : "Roles",
                href: `/${currentLang}/about/roles`,
            },
            {
                name: isNo ? "Lærere / frivillige" : "Teachers / volunteers",
                href: `/${currentLang}/about/teachers-volunteers-overview`,
            },
            {
                name: isNo ? "Grupper" : "Teams",
                href: `/${currentLang}/about/teams-overview`,
            },
            {
                name: isNo ? "Hvor" : "Where",
                href: `/${currentLang}/about/where`,
            },
            { name: isNo ? "Hvem" : "Who", href: `/${currentLang}/about/who` },
        ],
    },
    {
        name: isNo ? "Kontakt oss" : "Contact us",
        href: `/${currentLang}/contact/`,
        dropdown: [
            {
                name: isNo ? "Anonym tilbakemelding" : "Anonymous feedback",
                href: `/${currentLang}/contact/anonymous-feedback`,
            },
            {
                name: isNo ? "Rapportering" : "Report/notification",
                href: `/${currentLang}/contact/report-notification`,
            },
            {
                name: isNo ? "Kontakt styret" : "Contact the board",
                href: `/${currentLang}/contact/contact-board`,
            },
            {
                name: isNo ? "Hvem spør jeg?" : "Who do I ask?",
                href: `/${currentLang}/contact/who-to-ask`,
            },
        ],
    },
    {
        name: isNo ? "Hva skjer" : "Events",
        href: `/${currentLang}/events/`,
        dropdown: [
            {
                name: isNo ? "Workshops" : "Workshops",
                href: `/${currentLang}/workshops`,
            },
            {
                name: isNo ? "Forestillinger" : "Shows",
                href: `/${currentLang}/events/shows`,
            },
            {
                name: "Festival",
                href: "https://www.facebook.com/osloimprofestival",
                external: true,
            },
        ],
    },
    {
        name: isNo ? "Bli med" : "Join us",
        href: `/${currentLang}/join/`,
        dropdown: [
            {
                name: isNo ? "Medlemskap" : "Membership",
                href: "https://docs.google.com/forms/d/e/1FAIpQLSdV5bdctjwA--rFLd-crQBrDNQD0y7E_1qlRrGbPpddraonZw/viewform",
                external: true,
            },
            {
                name: isNo
                    ? "Nytt improvisasjonsteam (mixer)"
                    : "New improv team (mixer)",
                href: `/${currentLang}/join/joinimprovteam`,
            },
        ],
    },
    {
        name: isNo ? "Retningslinjer" : "Policies",
        href: `/${currentLang}/policies/`,
        dropdown: [
            {
                name: isNo ? "Etiske retningslinjer" : "Code of conduct",
                href: `/${currentLang}/policies/codeofconduct`,
            },
            {
                name: isNo ? "Personvernserklæring" : "Privacy policy",
                href: `/${currentLang}/policies/privacypolicy`,
            },
            {
                name: isNo ? "Salgsvilkår" : "Terms of sale",
                href: `/${currentLang}/policies/termsofsale`,
            },
        ],
    },
    {
        name: isNo ? "Ressurser for frivillige" : "Resources for volunteers",
        href: `/${currentLang}/resources/`,
        dropdown: [
            {
                name: isNo ? "Show-manual" : "Show manual",
                href: `/${currentLang}/resources/showhowtodo`,
            },
            {
                name: isNo ? "Workshop-manual" : "Workshop manual",
                href: `/${currentLang}/resources/workshophowtodo`,
            },
        ],
    },
    {
        name: "Social media",
        href: "#",
        dropdown: [
            {
                name: "Facebook",
                href: "https://www.facebook.com/groups/improneufcommunity",
                external: true,
            },
            {
                name: "Instagram",
                href: "https://www.instagram.com/improneuflovesyou/",
                external: true,
            },
        ],
    },
];

const langSwitcherText = isNo ? "English" : "Norsk";
const langSwitcherHref = isNo
    ? pathname.replace("/no", "/en")
    : pathname.replace("/en", "/no");
const targetLang = isNo ? "en" : "no";
---

<header class="header">
    <div class="container nav-container">
        <div class="logo">
            <a href={`/${currentLang}/`}>IMPRO NEUF</a>
        </div>
        <nav class="nav">
            <ul class="nav-list">
                {
                    navLinks.map((link) => (
                        <li class="nav-item">
                            <a
                                href={link.href}
                                class="nav-link"
                                {...(link?.external
                                    ? {
                                          target: "_blank",
                                          rel: "noopener noreferrer",
                                      }
                                    : {})}
                            >
                                {link.name}
                                {link.dropdown && <span class="arrow">▼</span>}
                            </a>
                            {link.dropdown && (
                                <ul class="dropdown">
                                    {link.dropdown.map((sub) => (
                                        <li>
                                            <a
                                                href={sub.href}
                                                {...(sub.external
                                                    ? {
                                                          target: "_blank",
                                                          rel: "noopener noreferrer",
                                                      }
                                                    : {})}
                                            >
                                                {sub.name}
                                                {sub.external && (
                                                    <span class="external-icon">
                                                        ↗
                                                    </span>
                                                )}
                                            </a>
                                        </li>
                                    ))}
                                </ul>
                            )}
                        </li>
                    ))
                }
                <li class="nav-item">
                    <a
                        href={langSwitcherHref}
                        class="nav-link lang-switcher"
                        data-lang={targetLang}
                    >
                        {langSwitcherText}
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</header>

<script>
    const switcher = document.querySelector(".lang-switcher");
    if (switcher) {
        switcher.addEventListener("click", (e) => {
            const lang = switcher.getAttribute("data-lang");
            if (lang) {
                localStorage.setItem("preferredLanguage", lang);
            }
        });
    }
</script>

<style>
    .header {
        position: sticky;
        top: 0;
        background: var(--color-white);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        padding: 1rem 0;
    }

    .nav-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .logo a {
        font-size: 1.5rem;
        font-weight: 700;
        letter-spacing: 1px;
    }

    .nav-list {
        display: flex;
        gap: 1.5rem;
    }

    .nav-item {
        position: relative;
    }

    .nav-link {
        font-weight: 600;
        padding: 0.5rem 0;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .arrow {
        font-size: 0.6rem;
    }

    .dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        background: var(--color-white);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border-radius: 4px;
        min-width: 15rem;
        display: none;
        flex-direction: column;
        padding: 0.5rem 0;
    }

    .nav-item:hover .dropdown {
        display: flex;
    }

    .dropdown li a {
        display: block;
        padding: 0.5rem 1rem;
        transition: background 0.2s;
    }

    .dropdown li a:hover {
        background: var(--color-gray-light);
    }

    .lang-switcher {
        border: 1px solid var(--color-black);
        padding: 0.25rem 0.75rem;
        border-radius: 4px;
    }
</style>
